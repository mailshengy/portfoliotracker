<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Portfolio Overview | Live Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          sans-serif;
        --bg: #f5f4f1;
        --accent: #bfa27a;
        --accent-dark: #9b825f;
        --text: #222222;
        --muted: #6e6e6e;
        --card: #ffffff;
        --positive: #2d5e38;
        --cpf-green: #91C799;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        background: var(--bg);
        color: var(--text);
        line-height: 1.6;
      }
      a {
        text-decoration: none;
        color: inherit;
      }
      header {
        position: sticky;
        top: 0;
        z-index: 50;
        background: rgba(245, 244, 241, 0.95);
        backdrop-filter: blur(8px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.04);
      }
      .nav {
        max-width: 1100px;
        margin: 0 auto;
        padding: 14px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .logo {
        font-size: 1.2rem;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        font-weight: 600;
      }
      .logo span {
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--accent);
        font-size: 0.7rem;
        margin-left: 10px;
        color: var(--accent-dark);
      }
      .nav-links {
        display: flex;
        gap: 18px;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
      }
      main {
        max-width: 1100px;
        margin: 0 auto;
        padding: 24px 20px 60px;
      }
      
      /* Sections */
      section { margin-top: 40px; }
      section h2 {
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        margin-bottom: 4px;
        border-left: 3px solid var(--accent);
        padding-left: 10px;
      }
      .section-intro {
        font-size: 0.9rem;
        color: var(--muted);
        max-width: 600px;
        margin-bottom: 20px;
        margin-left: 13px;
      }

      /* Hero / Summary */
      .hero {
        display: grid;
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.8fr);
        gap: 40px;
        align-items: flex-start;
        padding: 28px 0 10px;
      }
      .hero-text h1 {
        font-size: clamp(2rem, 3.5vw, 2.8rem);
        letter-spacing: 0.04em;
        text-transform: uppercase;
        margin-bottom: 8px;
        line-height: 1.2;
      }
      .total-wealth {
        font-size: 2.2rem;
        font-weight: 700;
        color: var(--accent-dark);
        margin-bottom: 16px;
        display: block;
      }
      .exchange-rate {
        font-size: 0.8rem;
        color: var(--muted);
        background: #e9e8e5;
        padding: 4px 8px;
        border-radius: 4px;
        display: inline-block;
        margin-bottom: 20px;
      }
      .chart-container {
        background: #fff;
        padding: 20px;
        border-radius: 18px;
        box-shadow: 0 10px 30px rgba(185, 162, 138, 0.1);
        position: relative;
        height: 350px;
        width: 100%;
      }
      canvas {
        max-width: 100%;
        max-height: 100%;
      }

      /* Cards */
      .grid { display: grid; gap: 16px; }
      @media (min-width: 768px) {
        .grid-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      }
      @media (max-width: 768px) {
        .hero { grid-template-columns: 1fr; }
        .chart-container { order: -1; height: 300px;}
      }

      .card {
        background: var(--card);
        padding: 18px;
        border-radius: 14px;
        border: 1px solid rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: transform 0.2s ease;
      }
      .card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
      
      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
      }
      .card-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--muted);
      }
      .yield-pill {
        background: #f0f7f2;
        color: var(--positive);
        font-size: 0.7rem;
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: 600;
        letter-spacing: 0.05em;
      }
      .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text);
      }
      .card-ticker {
        font-size: 0.8rem;
        color: var(--accent-dark);
        font-family: monospace;
        margin-bottom: 12px;
      }
      .data-row {
        display: flex;
        justify-content: space-between;
        font-size: 0.9rem;
        margin-bottom: 6px;
        border-bottom: 1px dashed #eee;
        padding-bottom: 4px;
      }
      .data-row:last-child { border-bottom: none; }
      .data-label { color: var(--muted); }
      .data-val { font-weight: 500; }
      .tsla-card {
        background: linear-gradient(145deg, #ffffff 0%, #fcfbf9 100%);
        border: 1px solid var(--accent);
      }
      .cpf-card {
        border-left: 6px solid var(--cpf-green);
      }
      .converted-val {
        font-size: 0.75rem;
        color: var(--muted);
        display: block;
        text-align: right;
      }
      
      /* Lists inside cards */
      .card-list {
        list-style: none;
        margin-top: 10px;
        font-size: 0.85rem;
        color: var(--muted);
        border-top: 1px solid #f0f0f0;
        padding-top: 10px;
      }
      .card-list li {
        margin-bottom: 6px;
        padding-left: 14px;
        position: relative;
      }
      .card-list li::before {
        content: "•";
        color: var(--accent);
        position: absolute;
        left: 0;
      }

      /* Settings Modal */
      .settings-section {
        margin-top: 60px;
        text-align: center;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
      }
      .btn-outline {
        background: transparent;
        border: 1px solid var(--accent-dark);
        color: var(--accent-dark);
        padding: 10px 20px;
        border-radius: 999px;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-size: 0.8rem;
        transition: all 0.2s;
      }
      .btn-outline:hover {
        background: var(--accent-dark);
        color: #fff;
      }
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        backdrop-filter: blur(4px);
        z-index: 100;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background: #fff;
        padding: 30px;
        border-radius: 14px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      }
      .modal-title {
        font-size: 1.2rem;
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
      }
      .form-group {
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .form-group label {
        font-size: 0.9rem;
        color: var(--muted);
      }
      .form-group input {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        width: 120px;
        text-align: right;
      }
      .modal-actions {
        margin-top: 25px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
      .btn-save { background: var(--accent-dark); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
      .btn-cancel { background: #eee; color: #333; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
    </style>
  </head>
  <body>
    <header>
      <nav class="nav">
        <div class="logo">
          PORTFOLIO <span>Live Dashboard</span>
        </div>
        <div class="nav-links">
          <a href="#summary">Summary</a>
          <a href="#growth">Growth</a>
          <a href="#equities">Equities</a>
          <a href="#cash">Cash</a>
        </div>
      </nav>
    </header>
    <main>
      <section class="hero" id="summary">
        <div class="hero-text">
          <h1>Portfolio Tracking</h1>
          <span class="total-wealth" id="total-wealth-display">Calculating...</span>
          <span class="exchange-rate">USD/SGD: 1.296 (Live)</span>
          <p>
            Real-time valuation of US Tech Growth, Singapore Banking Dividends, Cash Reserves, and CPF Special Account.
          </p>
        </div>
        <div class="chart-container">
          <canvas id="portfolioChart"></canvas>
        </div>
      </section>

      <section id="growth">
        <h2>Portfolio Growth (Quarterly)</h2>
        <p class="section-intro">
          Historical valuation of current assets from Jan 2022 to Dec 2025.
        </p>
        <div class="chart-container" style="height: 300px;">
          <canvas id="growthChart"></canvas>
        </div>
      </section>

      <section id="equities">
        <h2>Equity Holdings</h2>
        <p class="section-intro">
          <strong>(CAGR)</strong> = Compound Annual Growth Rate since Nov 2021. <br>
          <strong>Abs. Return</strong> = Total percentage gain/loss on initial capital.
        </p>
        
        <div class="grid grid-3">
          <article class="card">
            <div class="card-header">
              <span class="card-label">High Growth</span>
              <span class="yield-pill" id="tsla-yield">--</span>
            </div>
            <div class="card-title">Tesla Inc.</div>
            <div class="card-ticker">TSLA (NASDAQ)</div>
            <div class="data-row">
              <span class="data-label">Holdings</span>
              <span class="data-val" id="tsla-qty">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Market Price</span>
              <span class="data-val" id="tsla-price">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Total Value</span>
              <div style="text-align:right">
                <span class="data-val" id="tsla-val-usd">--</span>
                <span class="converted-val" id="tsla-val-sgd">--</span>
              </div>
            </div>
            <div class="data-row">
              <span class="data-label">Abs. Return</span>
              <span class="data-val" id="tsla-abs">--</span>
            </div>
          </article>

          <article class="card">
            <div class="card-header">
              <span class="card-label">Index ETF</span>
              <span class="yield-pill" id="voo-yield">--</span>
            </div>
            <div class="card-title">S&P 500</div>
            <div class="card-ticker">VOO (NYSE)</div>
            <div class="data-row">
              <span class="data-label">Holdings</span>
              <span class="data-val" id="voo-qty">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Market Price</span>
              <span class="data-val" id="voo-price">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Total Value</span>
              <div style="text-align:right">
                <span class="data-val" id="voo-val-usd">--</span>
                <span class="converted-val" id="voo-val-sgd">--</span>
              </div>
            </div>
            <div class="data-row">
              <span class="data-label">Abs. Return</span>
              <span class="data-val" id="voo-abs">--</span>
            </div>
          </article>

          <article class="card">
            <div class="card-header">
              <span class="card-label">Tech ETF</span>
              <span class="yield-pill" id="qqqm-yield">--</span>
            </div>
            <div class="card-title">Nasdaq 100</div>
            <div class="card-ticker">QQQM (NASDAQ)</div>
            <div class="data-row">
              <span class="data-label">Holdings</span>
              <span class="data-val" id="qqqm-qty">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Market Price</span>
              <span class="data-val" id="qqqm-price">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Total Value</span>
              <div style="text-align:right">
                <span class="data-val" id="qqqm-val-usd">--</span>
                <span class="converted-val" id="qqqm-val-sgd">--</span>
              </div>
            </div>
            <div class="data-row">
              <span class="data-label">Abs. Return</span>
              <span class="data-val" id="qqqm-abs">--</span>
            </div>
          </article>
        </div>

        <div class="grid grid-3" style="margin-top: 16px;">
          <article class="card">
            <div class="card-header">
              <span class="card-label">SG Bank</span>
              <span class="yield-pill" id="ocbc-yield">--</span>
            </div>
            <div class="card-title">OCBC Bank</div>
            <div class="card-ticker">O39.SI</div>
            <div class="data-row">
              <span class="data-label">Holdings</span>
              <span class="data-val" id="ocbc-qty">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Market Price</span>
              <span class="data-val" id="ocbc-price">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Total Value</span>
              <span class="data-val" id="ocbc-val">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Abs. Return</span>
              <span class="data-val" id="ocbc-abs">--</span>
            </div>
          </article>

          <article class="card">
            <div class="card-header">
              <span class="card-label">SG Bank</span>
              <span class="yield-pill" id="uob-yield">--</span>
            </div>
            <div class="card-title">UOB Bank</div>
            <div class="card-ticker">U11.SI</div>
            <div class="data-row">
              <span class="data-label">Holdings</span>
              <span class="data-val" id="uob-qty">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Market Price</span>
              <span class="data-val" id="uob-price">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Total Value</span>
              <span class="data-val" id="uob-val">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Abs. Return</span>
              <span class="data-val" id="uob-abs">--</span>
            </div>
          </article>

          <article class="card">
            <div class="card-header">
              <span class="card-label">SG Bank</span>
              <span class="yield-pill" id="dbs-yield">--</span>
            </div>
            <div class="card-title">DBS Group</div>
            <div class="card-ticker">D05.SI</div>
            <div class="data-row">
              <span class="data-label">Holdings</span>
              <span class="data-val" id="dbs-qty">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Market Price</span>
              <span class="data-val" id="dbs-price">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Total Value</span>
              <span class="data-val" id="dbs-val">--</span>
            </div>
            <div class="data-row">
              <span class="data-label">Abs. Return</span>
              <span class="data-val" id="dbs-abs">--</span>
            </div>
          </article>
        </div>
      </section>

      <section id="cash">
        <h2>Cash & Government Securities</h2>
        <div class="grid grid-3">
          <article class="card">
            <div class="card-header">
              <span class="card-label">Bonus$aver</span>
              <span class="yield-pill">4.55% PA</span>
            </div>
            <div class="card-title">Primary Cash</div>
            <div class="card-title" style="font-size:1.4rem; margin:10px 0;" id="cash1-display">--</div>
            <ul class="card-list">
               <li>Credit Salary > $3,000</li>
               <li>Card Spend > $1,000</li>
               <li>Invest $30k per 6 mo</li>
            </ul>
          </article>

          <article class="card">
            <div class="card-header">
              <span class="card-label">E Saver</span>
              <span class="yield-pill">1.65% PA</span>
            </div>
            <div class="card-title">Reserves</div>
            <div class="card-title" style="font-size:1.4rem; margin:10px 0;" id="cash2-display">--</div>
            <ul class="card-list">
               <li>Wealth Holdings</li>
               <li>Rotate out every 2 mo</li>
               <li>Backup Capital Dry Powder</li>
            </ul>
          </article>

          <article class="card cpf-card">
            <div class="card-header">
              <span class="card-label">CPF</span>
              <span class="yield-pill">4.0% PA</span>
            </div>
            <div class="card-title">Special Account</div>
            <div class="card-title" style="font-size:1.4rem; margin:10px 0;" id="cpf-display">--</div>
            <ul class="card-list">
               <li>Risk Free Yield</li>
               <li>Retirement Sum</li>
               <li>Capital Preservation</li>
            </ul>
          </article>
        </div>
      </section>

      <section class="settings-section">
        <button class="btn-outline" onclick="openModal()">Adjust Portfolio Holdings</button>
      </section>

    </main>

    <div class="modal-overlay" id="holdingsModal">
      <div class="modal-content">
        <h3 class="modal-title">Adjust Holdings</h3>
        <div id="modal-inputs"></div>
        <div class="modal-actions">
          <button class="btn-cancel" onclick="closeModal()">Cancel</button>
          <button class="btn-save" onclick="saveHoldings()">Save Changes</button>
        </div>
      </div>
    </div>

    <script>
      // 1. Configuration & Data
      const USD_TO_SGD = 1.296; 
      const DATE_START = new Date("2021-11-12");
      const DATE_NOW = new Date("2025-12-05");
      const YEARS_HELD = Math.abs(DATE_NOW - DATE_START) / (1000 * 60 * 60 * 24 * 365.25); 

      let holdings = {
        tsla: { qty: 60, initial: 328.00, currency: 'USD', name: 'TSLA', type: 'equity' },
        voo:  { qty: 12, initial: 430.00, currency: 'USD', name: 'S&P 500', type: 'equity' },
        qqqm: { qty: 30, initial: 162.00, currency: 'USD', name: 'QQQM', type: 'equity' },
        ocbc: { qty: 200, initial: 12.00, currency: 'SGD', name: 'OCBC', type: 'equity' },
        uob:  { qty: 100, initial: 27.00, currency: 'SGD', name: 'UOB', type: 'equity' },
        dbs:  { qty: 100, initial: 32.00, currency: 'SGD', name: 'DBS', type: 'equity' },
        cash1: { qty: 1, price: 100000, initial: 100000, currency: 'SGD', name: 'Bonus$aver', type: 'cash' },
        cash2: { qty: 1, price: 70000, initial: 70000, currency: 'SGD', name: 'E Saver', type: 'cash' },
        cpf:   { qty: 1, price: 120000, initial: 120000, currency: 'SGD', name: 'CPF SA', type: 'cash' }
      };

      // 2. Fetch "Live" Data
      async function fetchMarketData() {
        const marketPrices = {
            tsla: 454.48,
            voo: 629.30,
            qqqm: 256.46,
            ocbc: 18.91,
            uob: 34.59,
            dbs: 54.29
        };
        for (const [key, price] of Object.entries(marketPrices)) {
            if(holdings[key]) holdings[key].price = price;
        }
        return true; 
      }

      // 3. Historical Data (Quarterly approx prices)
      // Dates: Jan 22, Apr 22, Jul 22, Oct 22, ...
      const histDates = [
        'Jan 22', 'Apr 22', 'Jul 22', 'Oct 22', 
        'Jan 23', 'Apr 23', 'Jul 23', 'Oct 23',
        'Jan 24', 'Apr 24', 'Jul 24', 'Oct 24',
        'Jan 25', 'Apr 25', 'Jul 25', 'Oct 25', 'Dec 25'
      ];
      
      const histPrices = {
        tsla: [312, 290, 297, 227, 173, 164, 267, 200, 187, 183, 232, 249, 404, 282, 308, 456, 454],
        voo:  [391, 359, 361, 339, 359, 369, 408, 374, 433, 452, 498, 516, 548, 506, 579, 627, 629],
        qqqm: [145, 125, 126, 112, 119, 130, 155, 142, 169, 173, 192, 197, 214, 195, 232, 258, 256],
        dbs:  [32.0, 30.8, 28.6, 31.1, 32.5, 29.8, 31.1, 29.8, 29.0, 34.9, 36.6, 38.6, 44.6, 42.4, 47.9, 53.9, 54.3],
        uob:  [29.9, 29.9, 27.5, 27.7, 29.8, 28.2, 30.1, 27.0, 28.3, 30.4, 32.3, 32.1, 37.5, 34.6, 36.2, 34.6, 34.6],
        ocbc: [11.4, 11.8, 11.5, 11.6, 12.2, 12.4, 12.6, 12.8, 13.0, 13.5, 14.2, 15.0, 14.0, 13.6, 16.0, 18.7, 18.9], // Est. Linear growth + annual pts
        usdSgd: [1.35, 1.37, 1.39, 1.42, 1.34, 1.33, 1.35, 1.37, 1.33, 1.35, 1.35, 1.32, 1.37, 1.32, 1.28, 1.30, 1.296]
      };

      function calculateHistoricalPortfolio() {
        // Assume Cash + CPF is constant baseline for "Investment Growth" visual
        // In reality, this would vary, but for "Strategy Backtest" we hold it constant
        const fixedCash = holdings.cash1.price + holdings.cash2.price + holdings.cpf.price;
        
        return histDates.map((date, i) => {
            let equityValue = 0;
            
            // TSLA
            equityValue += (holdings.tsla.qty * histPrices.tsla[i]) * histPrices.usdSgd[i];
            // VOO
            equityValue += (holdings.voo.qty * histPrices.voo[i]) * histPrices.usdSgd[i];
            // QQQM
            equityValue += (holdings.qqqm.qty * histPrices.qqqm[i]) * histPrices.usdSgd[i];
            // DBS
            equityValue += (holdings.dbs.qty * histPrices.dbs[i]);
            // UOB
            equityValue += (holdings.uob.qty * histPrices.uob[i]);
            // OCBC
            equityValue += (holdings.ocbc.qty * histPrices.ocbc[i]);

            return equityValue + fixedCash;
        });
      }

      // 4. Render Logic
      let myChart = null;
      let lineChart = null;

      const formatCurrency = (val, currency) => {
        return new Intl.NumberFormat('en-SG', { 
          style: 'currency', currency: currency, maximumFractionDigits: 0
        }).format(val);
      };

      const calculateReturns = (current, initial) => {
        if (current === initial || !initial) return { cagr: "--", abs: "--" };
        const cagrVal = (Math.pow((current / initial), (1 / YEARS_HELD)) - 1) * 100;
        const cagrStr = (cagrVal > 0 ? '+' : '') + cagrVal.toFixed(1) + '% PA (CAGR)';
        const absVal = ((current - initial) / initial) * 100;
        const absStr = (absVal > 0 ? '+' : '') + absVal.toFixed(1) + '%';
        return { cagr: cagrStr, abs: absStr };
      };

      async function renderDashboard() {
        await fetchMarketData();

        let totalPortfolioValueSGD = 0;
        const chartLabels = [];
        const chartData = [];
        const chartColors = ['#9b825f', '#bfa27a', '#cab9a1', '#8a6b46', '#d5c6b3', '#e6dace', '#5c5c5c', '#9e9e9e', '#91C799'];

        for (const [key, asset] of Object.entries(holdings)) {
          let currentValueRaw = (asset.type === 'cash') ? asset.price : (asset.qty * asset.price);
          let currentValueSGD = currentValueRaw;

          if (asset.currency === 'USD') {
            currentValueSGD = currentValueRaw * USD_TO_SGD;
            if(document.getElementById(`${key}-val-usd`)) {
              document.getElementById(`${key}-qty`).textContent = asset.qty + " Units";
              document.getElementById(`${key}-price`).textContent = "$" + asset.price + " USD";
              document.getElementById(`${key}-val-usd`).textContent = formatCurrency(currentValueRaw, 'USD');
              document.getElementById(`${key}-val-sgd`).textContent = `≈ ${formatCurrency(currentValueSGD, 'SGD')}`;
              
              const returns = calculateReturns(asset.price, asset.initial);
              document.getElementById(`${key}-yield`).textContent = returns.cagr;
              document.getElementById(`${key}-abs`).textContent = returns.abs;
            }
          } else {
            if (asset.type === 'cash') {
                if(document.getElementById(`${key}-display`)) {
                    document.getElementById(`${key}-display`).textContent = formatCurrency(currentValueRaw, 'SGD');
                }
            } else {
                if(document.getElementById(`${key}-val`)) {
                    document.getElementById(`${key}-qty`).textContent = asset.qty + " Units";
                    document.getElementById(`${key}-price`).textContent = "$" + asset.price + " SGD";
                    document.getElementById(`${key}-val`).textContent = formatCurrency(currentValueRaw, 'SGD');
                    
                    const returns = calculateReturns(asset.price, asset.initial);
                    document.getElementById(`${key}-yield`).textContent = returns.cagr;
                    document.getElementById(`${key}-abs`).textContent = returns.abs;
                }
            }
          }

          totalPortfolioValueSGD += currentValueSGD;
          chartLabels.push(asset.name);
          chartData.push(currentValueSGD);
        }

        document.getElementById('total-wealth-display').textContent = formatCurrency(totalPortfolioValueSGD, 'SGD');

        // Doughnut Chart
        const ctx = document.getElementById('portfolioChart').getContext('2d');
        if (myChart) { myChart.destroy(); }
        myChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: chartLabels,
            datasets: [{
              data: chartData,
              backgroundColor: chartColors,
              borderWidth: 0,
              hoverOffset: 10
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '60%',
            plugins: {
              legend: { position: 'right', labels: { usePointStyle: true, font: { family: 'system-ui' } } }
            }
          }
        });

        // Line Chart (Growth)
        const ctxLine = document.getElementById('growthChart').getContext('2d');
        if (lineChart) { lineChart.destroy(); }
        
        const historicalValues = calculateHistoricalPortfolio();
        
        lineChart = new Chart(ctxLine, {
            type: 'line',
            data: {
                labels: histDates,
                datasets: [{
                    label: 'Total Portfolio Value (SGD)',
                    data: historicalValues,
                    borderColor: '#bfa27a',
                    backgroundColor: 'rgba(191, 162, 122, 0.1)',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 3,
                    pointBackgroundColor: '#9b825f'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: { font: { family: 'system-ui', size: 10 } }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { font: { family: 'system-ui', size: 10 } }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                return formatCurrency(context.raw, 'SGD');
                            }
                        }
                    }
                }
            }
        });
      }

      // 5. Modal Logic
      function openModal() {
        const container = document.getElementById('modal-inputs');
        container.innerHTML = ''; 
        for (const [key, asset] of Object.entries(holdings)) {
            const div = document.createElement('div');
            div.className = 'form-group';
            let labelText = asset.name + (asset.type === 'equity' ? " (Qty)" : " ($)");
            let val = asset.type === 'equity' ? asset.qty : asset.price;
            div.innerHTML = `<label>${labelText}</label><input type="number" id="input-${key}" value="${val}" />`;
            container.appendChild(div);
        }
        document.getElementById('holdingsModal').style.display = 'flex';
      }

      function closeModal() {
        document.getElementById('holdingsModal').style.display = 'none';
      }

      function saveHoldings() {
        for (const [key, asset] of Object.entries(holdings)) {
            const inputVal = parseFloat(document.getElementById(`input-${key}`).value);
            if (asset.type === 'equity') { holdings[key].qty = inputVal; } 
            else { holdings[key].price = inputVal; }
        }
        closeModal();
        renderDashboard(); 
      }

      renderDashboard();
    </script>
  </body>
</html>